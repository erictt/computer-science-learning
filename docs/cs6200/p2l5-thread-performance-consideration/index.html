<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          Eric&#39;s CS Notes
        
    </title>

    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.18.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.18.2/tocbot.css">
    
    <!-- katex css -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.3/dist/katex.min.css" integrity="sha384-Juol1FqnotbkyZUT5Z7gUPjQ9gzlwCENvUZTpQBAPxtusdwFLRy382PSDx5UUJ4/" crossorigin="anonymous">

    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

<meta name="generator" content="Hexo 6.3.0"></head>


<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>ERIC&#39;S CS NOTES</span>
  </a>
</div>

    <div class="book-menu">
  <!--
## Introduction to Probability

* [Unit 1: Probability models and axioms](/introduction-to-probability/unit-1/index.html)
* [Unit 2: Conditioning and independence](/introduction-to-probability/unit-2/index.html)
* [Unit 3: Counting](/introduction-to-probability/unit-3/index.html)
* [Unit 4: Discrete random variables](/introduction-to-probability/unit-4/index.html)
* [Unit 5: Continuous random variables](/introduction-to-probability/unit-5/index.html)
* [Unit 6: Further topics on random variables](/introduction-to-probability/unit-6/index.html)
* [Unit 7: Bayesian inference](/introduction-to-probability/unit-7/index.html)
* [Unit 8: Limit theorems and classical statistics](/introduction-to-probability/unit-8/index.html)
* [Unit 9: Bernoulli and Poisson processes](/introduction-to-probability/unit-9/index.html)
* [Unit 10: Markov chains](/introduction-to-probability/unit-10/index.html)
-->
<!--
## Multivariable Calculus

* [Unit 1: Thinking about multivariable functions](/multivariable-calculus/unit-1/index.html)
* [Unit 2: Derivatives of multivariable functions](/multivariable-calculus/unit-2/index.html)

* [Unit 3: Applications of multivariable derivatives](/multivariable-calculus/unit-3/index.html)
* [Unit 4: Integrating multivariable functions](/multivariable-calculus/unit-4/index.html)
* [Unit 5: Green's, Stokes', and the divergence theorems](/multivariable-calculus/unit-5/index.html)
-->
<h2 id="cs6210-advanced-operating-systems"><a class="markdownIt-Anchor" href="#cs6210-advanced-operating-systems"></a> CS6210: Advanced Operating Systems</h2>
<ul>
<li><a href="/cs6210/lesson-02/index.html">Lesson 2: OS Structure</a></li>
<li><a href="/cs6210/lesson-03/index.html">Lesson 3: Virtualization</a></li>
<li><a href="/cs6210/lesson-04a/index.html">Lesson 4: Parallel Systems - Part 1</a></li>
<li><a href="/cs6210/lesson-04b/index.html">Lesson 4: Parallel Systems - Part 2</a></li>
<li><a href="/cs6210/lesson-05/index.html">Lesson 5: Distributed Systems</a></li>
<li><a href="/cs6210/lesson-06/index.html">Lesson 6: Distributed Objects and Middleware</a></li>
<li><a href="/cs6210/lesson-07a/index.html">Lesson 7: Distributed Subsystems - GMS</a></li>
<li><a href="/cs6210/lesson-07b/index.html">Lesson 7: Distributed Subsystems - DSM</a></li>
<li><a href="/cs6210/lesson-07c/index.html">Lesson 7: Distributed Subsystems - DFS</a></li>
<li><a href="/cs6210/lesson-09/index.html">Lesson 9: Internet Computing</a></li>
<li><a href="/cs6210/lesson-10/index.html">Lesson 10: RT and Multimedia</a></li>
</ul>
<!--
* [Lesson 8: Failures and Recovery](/cs6210/lesson-08/index.html)
* [Lesson 11: Security](/cs6210/lesson-11/index.html)
-->
<h2 id="cs6250-computer-networks"><a class="markdownIt-Anchor" href="#cs6250-computer-networks"></a> CS6250 Computer Networks</h2>
<ul>
<li><a href="/cs6250/week-1-internet-architecture/index.html">Week 1 - Internet Architecture</a></li>
<li><a href="/cs6250/week-2-transport-and-application-layers/index.html">Week 2 - Transport and Application Layers</a></li>
<li><a href="/cs6250/week-3-intradomain-routing/index.html">Week 3 - Intradomain Routing</a></li>
<li><a href="/cs6250/week-4-as-relationships-and-interdomain-routing/index.html">Week 4 - AS Relationships and Interdomain Routing</a></li>
<li><a href="/cs6250/week-5-router-design-and-algorithems-part-1/index.html">Week 5 - Router Design and Algorithms (Part 1)</a></li>
<li><a href="/cs6250/week-6-router-design-and-algorithems-part-2/index.html">Week 6 - Router Design and Algorithms (Part 2)</a></li>
<li><a href="/cs6250/week-7-software-defined-networking-part-1/index.html">Week 7 - Software Defined Networking (Part 1)</a></li>
<li><a href="/cs6250/week-8-software-defined-networking-part-2/index.html">Week 8 - Software Defined Networking (Part 2)</a></li>
<li><a href="/cs6250/week-9-internet-security/index.html">Week 9 - Internet Security</a></li>
<li><a href="/cs6250/week-10-internet-surveillance-and-censorship/index.html">Week 10 - Internet Surveillance and Censorship</a></li>
<li><a href="/cs6250/week-11-applications-video/index.html">Week 11 - Applications Videos</a></li>
<li><a href="/cs6250/week-12-applications-cdns-and-overlay-networks/index.html">Week 12 - Applications CDNs and Overlay Networks</a></li>
</ul>
<h2 id="cs6200-graduate-introduction-to-operating-systems"><a class="markdownIt-Anchor" href="#cs6200-graduate-introduction-to-operating-systems"></a> CS6200 Graduate Introduction to Operating Systems</h2>
<ul>
<li><a href="/cs6200/p1-preparation/index.html">P0 - Preparation</a></li>
<li><a href="/cs6200/p1l2-introduction/index.html">P1L2 - Introduction</a></li>
<li><a href="/cs6200/p2l1-processes-and-process-management/index.html">P2L1 - Processes and Process Management</a></li>
<li><a href="/cs6200/p2l2-threads-and-concurrency/index.html">P2L2 - Threads and Concurrency</a></li>
<li><a href="/cs6200/p2l3-pthread/index.html">P2L3 - PThread</a></li>
<li><a href="/cs6200/p2l4-thread-design-consideration/index.html">P2L4 - Thread Design Considerations</a></li>
<li><a href="/cs6200/p2l5-thread-performance-consideration/index.html">P2L5 - Thread Performance Considerations</a></li>
<li><a href="/cs6200/p3l1-scheduling/index.html">P3L1 - Scheduling</a></li>
<li><a href="/cs6200/p3l2-memory-management/index.html">P3L2 - Memory Management</a></li>
<li><a href="/cs6200/p3l3-inter-process-communication/index.html">P3L3 - Inter-Process Communication</a></li>
<li><a href="/cs6200/p3l4-synchronization-constructs/index.html">P3L4 - Synchronization Constructs</a></li>
<li><a href="/cs6200/p3l5-io-management/index.html">P3L5 - I/O Management</a></li>
<li><a href="/cs6200/p3l6-virtualization/index.html">P3L6 - Virtualization</a></li>
</ul>
<!--
* [P4L1 - Remote Procedure Calls](/cs6200/p4l1-remote-procedure-calls/index.html) 
* [P4L2 - Distributed File Systems](/cs6200/p4l2-distributed-file-systems/index.html) 
* [P4L3 - Distributed Shared Memory](/cs6200/p4l3-distributed-shared-memory/index.html) 
* [P4L4 - Datacenter Technologies](/cs6200/p4l4-datacenter-technologies/index.html) 
-->
<h2 id="algorithms-part-ii"><a class="markdownIt-Anchor" href="#algorithms-part-ii"></a> Algorithms: Part II</h2>
<ul>
<li><a href="/algorithms-2/week-1/index.html">Week 1 - Undirected Graph &amp; Directed Graph</a></li>
<li><a href="/algorithms-2/week-2/index.html">Week 2 - Minimum Spanning Trees &amp; Shortest Path</a></li>
<li><a href="/algorithms-2/week-3/index.html">Week 3 - Maximum Flow and Minimum Cut &amp; String Sort</a></li>
<li><a href="/algorithms-2/week-4/index.html">Week 4 - Tries &amp; Substring Search</a></li>
<li><a href="/algorithms-2/week-5/index.html">Week 5 - Regular Expressions</a></li>
<li><a href="/algorithms-2/week-6/index.html">Week 6 - Reductions</a></li>
</ul>
<h2 id="algorithms-part-i"><a class="markdownIt-Anchor" href="#algorithms-part-i"></a> Algorithms: Part I</h2>
<ul>
<li><a href="/algorithms-1/week-1/index.html">Week 1 - Union-Find &amp; Analysis of Algorithms</a></li>
<li><a href="/algorithms-1/week-2/index.html">Week 2 - Stacks and Queues &amp; Elementary Sorts</a></li>
<li><a href="/algorithms-1/week-3/index.html">Week 3 - Mergesort &amp; Quicksort</a></li>
<li><a href="/algorithms-1/week-4/index.html">Week 4 - Priority Queues &amp; Elementary Symbols</a></li>
<li><a href="/algorithms-1/week-5/index.html">Week 5 - Balanced Search Trees</a></li>
<li><a href="/algorithms-1/week-6/index.html">Week 6 - Hash Tables</a></li>
</ul>
<h2 id="introduction-to-software-design-and-architecture"><a class="markdownIt-Anchor" href="#introduction-to-software-design-and-architecture"></a> Introduction to Software Design and Architecture</h2>
<ul>
<li><a href="/introduction-to-software-design-and-architecture/design-pattern/index.html">Design Pattern</a></li>
</ul>
<h2 id="calculus-two-sequences-and-series"><a class="markdownIt-Anchor" href="#calculus-two-sequences-and-series"></a> Calculus Two: Sequences and Series</h2>
<ul>
<li><a href="/calculus-two/week-1/index.html">Week 1 - Sequences</a></li>
<li><a href="/calculus-two/week-2/index.html">Week 2 - Series</a></li>
<li><a href="/calculus-two/week-3/index.html">Week 3 - Convergence Tests</a></li>
<li><a href="/calculus-two/week-4/index.html">Week 4 - Alternating Series</a></li>
<li><a href="/calculus-two/week-5/index.html">Week 5 - Power Series</a></li>
<li><a href="/calculus-two/week-6/index.html">Week 6 - Taylor Series</a></li>
</ul>
<h2 id="laff-linear-algebra"><a class="markdownIt-Anchor" href="#laff-linear-algebra"></a> LAFF Linear Algebra</h2>
<ul>
<li><a href="/laff-linear-algebra/week-1/index.html">Week 1 - Vectors in Linear Algebra</a></li>
<li><a href="/laff-linear-algebra/week-2/index.html">Week 2 - Linear Transformations and Matrices</a></li>
<li><a href="/laff-linear-algebra/week-3/index.html">Week 3 - Matrix-Vector Operations</a></li>
<li><a href="/laff-linear-algebra/week-4/index.html">Week 4 - Matrix-Vector to Matrix-Matrix Multiplication</a></li>
<li><a href="/laff-linear-algebra/week-5/index.html">Week 5 - Matrix- Matrix Multiplication</a></li>
<li><a href="/laff-linear-algebra/week-6/index.html">Week 6 - Gaussian Elimination</a></li>
<li><a href="/laff-linear-algebra/week-7/index.html">Week 7 - More Gaussian Elimination and Matrix Inversion</a></li>
<li><a href="/laff-linear-algebra/week-8/index.html">Week 8 - More on Matrix Inversion</a></li>
<li><a href="/laff-linear-algebra/week-9/index.html">Week 9 - Vector Spaces</a></li>
<li><a href="/laff-linear-algebra/week-10/index.html">Week 10 - Vector Spaces, Orthogonality, and Linear Least-Squares</a></li>
<li><a href="/laff-linear-algebra/week-11/index.html">Week 11 - Orthogonal Projection, Low Rank Approximation, and Orthogonal Bases</a></li>
<li><a href="/laff-linear-algebra/week-12/index.html">Week 12 - Eigenvalues and Eigenvectors</a></li>
</ul>
<h2 id="stanford-machine-learning"><a class="markdownIt-Anchor" href="#stanford-machine-learning"></a> Stanford Machine Learning</h2>
<ul>
<li><a href="/stanford-machine-learning/week-1/index.html">Week 1 - Introduction</a></li>
<li><a href="/stanford-machine-learning/week-2/index.html">Week 2 - Linear Regression with Multiple Variables</a></li>
<li><a href="/stanford-machine-learning/week-3/index.html">Week 3 - Logistic Regression &amp; Regularization</a></li>
<li><a href="/stanford-machine-learning/week-4/index.html">Week 4 - Neural Networks: Representation</a></li>
<li><a href="/stanford-machine-learning/week-5/index.html">Week 5 - Neural Networks: Learning</a></li>
<li><a href="/stanford-machine-learning/week-6a/index.html">Week 6a - Advice for Applying Machine Learning</a></li>
<li><a href="/stanford-machine-learning/week-6b/index.html">Week 6b - Machine Learning System Design</a></li>
<li><a href="/stanford-machine-learning/week-7/index.html">Week 7 - Support Vector Machines</a></li>
<li><a href="/stanford-machine-learning/week-8/index.html">Week 8 - Unsupervised Learning &amp; Dimensionality Reduction</a></li>
<li><a href="/stanford-machine-learning/week-9a/index.html">Week 9a - Anomaly Detection</a></li>
<li><a href="/stanford-machine-learning/week-9b/index.html">Week 9b - Recommender Systems</a></li>
<li><a href="/stanford-machine-learning/week-10/index.html">Week 10 - Large Scale Machine Learning</a></li>
<li><a href="/stanford-machine-learning/week-11/index.html">Week 11 - Application Example: Photo OCR</a></li>
</ul>
<h2 id="calculus-one"><a class="markdownIt-Anchor" href="#calculus-one"></a> Calculus One</h2>
<ul>
<li><a href="/calculus-one/week-2-3/index.html">Week 2-3 - Functions &amp; Limits</a></li>
<li><a href="/calculus-one/week-4/index.html">Week 4 - The Beginning of Derivatives</a></li>
<li><a href="/calculus-one/week-5/index.html">Week 5 - Techniques of Differentiation</a></li>
<li><a href="/calculus-one/week-6/index.html">Week 6 - Chain Rule</a></li>
<li><a href="/calculus-one/week-7/index.html">Week 7 - Derivatives of Trigonometric Functions</a></li>
<li><a href="/calculus-one/week-8/index.html">Week 8 - Derivatives in the Real World</a></li>
<li><a href="/calculus-one/week-9/index.html">Week 9 - Optimization</a></li>
<li><a href="/calculus-one/week-10/index.html">Week 10 - Linear Approximation</a></li>
<li><a href="/calculus-one/week-11-12/index.html">Week 11-12 - Antidifferentiation &amp; Integration</a></li>
<li><a href="/calculus-one/week-13/index.html">Week 13 - Fundamental Theorem of Calculus</a></li>
<li><a href="/calculus-one/week-14/index.html">Week 14 - Substitution Rule</a></li>
<li><a href="/calculus-one/week-15/index.html">Week 15 - Techniques of Integration</a></li>
<li><a href="/calculus-one/week-16/index.html">Week 16 - Applications of Integration</a></li>
</ul>
<h2 id="computational-thinking"><a class="markdownIt-Anchor" href="#computational-thinking"></a> Computational Thinking</h2>
<ul>
<li><a href="/computational-thinking/lecture-1/index.html">Lecture 1 - Optimization and Knapsack Problem</a></li>
<li><a href="/computational-thinking/lecture-2/index.html">Lecture 2 - Decision Trees and Dynamic Programming</a>
<ul>
<li><a href="/computational-thinking/lecture-2-powerset/index.html">Exercise: Power Set Function</a></li>
</ul>
</li>
<li><a href="/computational-thinking/lecture-3/index.html">Lecture 3 - Graphs</a></li>
<li><a href="/computational-thinking/lecture-4-5/index.html">Lecture 4-5 - Plotting</a></li>
<li><a href="/computational-thinking/lecture-6-7/index.html">Lecture 6-7 - Stochastic Programs &amp; Inferential Statistics</a></li>
<li><a href="/computational-thinking/lecture-8/index.html">Lecture 8 - Monte Carlo Simulation</a></li>
<li><a href="/computational-thinking/lecture-9/index.html">Lecture 9 - Sampling and Standard Error</a></li>
<li><a href="/computational-thinking/lecture-10-11/index.html">Lecture 10-11 - Experimental Data</a></li>
<li><a href="/computational-thinking/lecture-12/index.html">Lecture 12 - Machine Learning</a></li>
<li><a href="/computational-thinking/lecture-13/index.html">Lecture 13 - Statistical Abuses</a></li>
</ul>
<h2 id="effective-thinking-through-mathematics"><a class="markdownIt-Anchor" href="#effective-thinking-through-mathematics"></a> Effective Thinking Through Mathematics</h2>
<ul>
<li><a href="/effective-thinking-through-mathematics/note/index.html">Note</a></li>
<li><a href="/effective-thinking-through-mathematics/week-4-telling-the-story-of-infinity/index.html">Week 4 (/Telling the Story of Infinity)</a></li>
<li><a href="/effective-thinking-through-mathematics/week-5-telling-the-story-of-the-euler-circuit-theorem/index.html">Week 5 (/Telling the Story of Euler Circuit Theorem)</a></li>
</ul>
<h2 id="cs50-introduction-to-computer-science"><a class="markdownIt-Anchor" href="#cs50-introduction-to-computer-science"></a> CS50 Introduction to Computer Science</h2>
<ul>
<li><a href="/cs50/week-1/index.html">Week 1 - C</a></li>
<li><a href="/cs50/week-2/index.html">Week 2 - Arrays</a></li>
<li><a href="/cs50/week-3/index.html">Week 3 - Algorithms</a></li>
<li><a href="/cs50/week-4/index.html">Week 4 - Memory</a></li>
<li><a href="/cs50/week-5/index.html">Week 5 - Data Structures</a></li>
<li><a href="/cs50/week-6/index.html">Week 6 - HTTP</a></li>
<li><a href="/cs50/week-7-10/index.html">Week 7-10 - Machine Learning/Python/SQL/Javascript</a></li>
</ul>
<h2 id="others"><a class="markdownIt-Anchor" href="#others"></a> Others</h2>
<ul>
<li><a href="/symbols/index.html">Symbols of Mathematics</a></li>
<li><a href="/glossary/index.html">Glossary</a></li>
</ul>
<h2 id="about-me"><a class="markdownIt-Anchor" href="#about-me"></a> <a target="_blank" rel="noopener" href="https://ericy.me/about/">About Me</a></h2>

</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="sidebar-toggle" onclick="sidebar_toggle()" onmouseover="add_inner()" onmouseleave="remove_inner()">
  <div class="sidebar-toggle-inner"></div>
</div>

<script>
function add_inner() {
  let inner = document.querySelector('.sidebar-toggle-inner')
  inner.classList.add('show')  
}

function remove_inner() {
  let inner = document.querySelector('.sidebar-toggle-inner')
  inner.classList.remove('show')
}

function sidebar_toggle() {
    let sidebar_toggle = document.querySelector('.sidebar-toggle')
    let sidebar = document.querySelector('.book-sidebar')
    let content = document.querySelector('.off-canvas-content')
    if (sidebar_toggle.classList.contains('extend')) { // show
        sidebar_toggle.classList.remove('extend')
        sidebar.classList.remove('hide')
        content.classList.remove('extend')
    }
    else { // hide
        sidebar_toggle.classList.add('extend')
        sidebar.classList.add('hide')
        content.classList.add('extend')
    }
}
</script>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <h1 id="p2l5-thread-performance-considerations"><a class="markdownIt-Anchor" href="#p2l5-thread-performance-considerations"></a> P2L5: Thread Performance Considerations</h1>
<!-- toc -->
<ul>
<li><a href="#which-threading-model-is-better">Which Threading Model Is Better?</a></li>
<li><a href="#are-threads-useful">Are Threads Useful?</a>
<ul>
<li><a href="#performance-metrics">Performance Metrics</a></li>
</ul>
</li>
<li><a href="#multi-process-vs-multi-threaded">Multi Process Vs. Multi Threaded</a></li>
<li><a href="#event-driven-model">Event-Driven Model</a>
<ul>
<li><a href="#helper-threads-and-processes">Helper Threads And Processes</a></li>
</ul>
</li>
<li><a href="#flash-event-driven-web-server">Flash: Event-Driven Web Server</a></li>
<li><a href="#apache-web-server">Apache Web Server</a></li>
<li><a href="#experimental-methodology">Experimental Methodology</a></li>
<li><a href="#experimental-results">Experimental Results</a></li>
<li><a href="#advice-on-designing-experiments">Advice on Designing Experiments</a></li>
<li><a href="#advice-on-running-experiments">Advice on Running Experiments</a></li>
<li><a href="#papers">Papers</a></li>
</ul>
<!-- tocstop -->
<hr>
<h2 id="which-threading-model-is-better"><a class="markdownIt-Anchor" href="#which-threading-model-is-better"></a> Which Threading Model Is Better?</h2>
<ul>
<li>Depends on the matrix we used to evaluate.</li>
<li>review the <a href="/cs6200/p2l2-threads-and-concurrency/index.html#quiz">quiz</a></li>
<li>
<img src="https://i.imgur.com/g0QGBWU.jpg" style="width: 600px" />
</li>
</ul>
<h2 id="are-threads-useful"><a class="markdownIt-Anchor" href="#are-threads-useful"></a> Are Threads Useful?</h2>
<ul>
<li>Threads are useful because:
<ol>
<li>parallelization: speed up the execution.</li>
<li>specialization: hot cache</li>
<li>efficiency. lower memory requirements and are cheaper to synchronize
<ol>
<li>Threads are useful even on a single CPU because they allow us to hide latency of I/O operations.</li>
</ol>
</li>
</ol>
</li>
<li>How to measure things are useful?
<ul>
<li>a matrix multiply application: raw execution time</li>
<li>web service application: throughput(requests/s) or response time</li>
<li>hardware chip: overall utilization increase</li>
<li>for any these matrix, we might care: average value or max/min value, or a certain percentage.</li>
<li>To evaluate or determine whether things are useful, it is important to determine the properties that we care. We can such properties <strong>matrices</strong>.</li>
</ul>
</li>
</ul>
<h3 id="performance-metrics"><a class="markdownIt-Anchor" href="#performance-metrics"></a> Performance Metrics</h3>
<ul>
<li>
<p>There are lots of useful matrices. we have discussed:</p>
<ul>
<li>execution time, throughput, request time, CPU utilization</li>
</ul>
</li>
<li>
<p>Some others:</p>
<ul>
<li>wait time: how long a job waited to start executing.</li>
<li>platform efficiency: how well resources are utilized.</li>
<li>performance per dollar/watt</li>
<li><strong>percentage of SLA violation</strong>:</li>
</ul>
</li>
<li>
<p>In summary we want measurable quantities that obtained from</p>
<ul>
<li>experiments with real software deployment, real machines, real workload.</li>
<li>these experimental settings are <strong>testbed</strong>.</li>
</ul>
</li>
<li>
<p>So are threads useful?</p>
<ul>
<li>It depends.</li>
</ul>
</li>
</ul>
<h2 id="multi-process-vs-multi-threaded"><a class="markdownIt-Anchor" href="#multi-process-vs-multi-threaded"></a> Multi Process Vs. Multi Threaded</h2>
<ul>
<li>
<p>Take a web server as an example:</p>
<ul>
<li>
<img src="https://i.imgur.com/D4jTsAL.jpg" style="width: 200px" />
</li>
</ul>
<ol>
<li>client/browser send request</li>
<li>web server accept request</li>
<li>server processing steps</li>
<li>respond by sending file</li>
</ol>
</li>
<li>
<p>Note that some work are CPU complexity like parse request/computer header, and some other are IO operations like accept connection, read/find file.</p>
</li>
<li>
<p>Multi Process Web Server: spawn multiple processes and run it in each process.</p>
<ul>
<li>Benefits:
<ul>
<li>Simple.</li>
<li>Each request is handled in a new process with its own address space: there is no need for any (explicit) synchronization code.</li>
</ul>
</li>
<li>Downside:
<ul>
<li>it require higher memory footprint, which can hurt the performance.</li>
<li>pay higher cost to context switch since processes don’t share states due to IPC constrains</li>
<li>it’s difficult to have multiple process listening on a specific port.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Multi-threaded Web Server: single process, with multiple threads, achieving concurrency within a single address space.</p>
<ul>
<li>we can adapt the boss-worker mode, or have a pipeline setup.</li>
<li>benefits:
<ul>
<li>have a shared address space, shared state,</li>
<li>a cheap user level context switch.</li>
<li>Memory requirements are lighter, since we have a lot of shared information across all threads in the process.</li>
</ul>
</li>
<li>Downside:
<ul>
<li>not a simple implementation. Multithreaded programs require explicit application level synchronization code, which can add to the overall complexity of the application.</li>
<li>a multithreaded approach depends on underlying operating system level support for threads, although this is less of an issue now than it was in the past.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="event-driven-model"><a class="markdownIt-Anchor" href="#event-driven-model"></a> Event-Driven Model</h2>
<ul>
<li>
<img src="https://i.imgur.com/RhtrFlu.jpg" style="width: 400px" />
</li>
<li>
<p>Event-driven model is composed with two parts:</p>
<ul>
<li>event dispatcher
<ul>
<li>work as a state machine of external events =&gt; call handler(jump to the code)</li>
<li>accept any of these types of notifications and based on the notification type invoke the right handler.</li>
</ul>
</li>
<li>event handlers, such accept connection, read request, etc.
<ul>
<li>If the handler needs to block (i.e. making an I/O request), the handler will initiate the blocking operation and immediately pass control back to the dispatch loop.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>It works in a <strong>single address space</strong>, a <strong>single process</strong> and a <strong>single thread of control</strong>.</p>
</li>
<li>
<p>How to achieve <strong>concurrency</strong> with only <strong>one</strong> thread?</p>
<ul>
<li>In the event driven model, the processing of multiple requests are <strong>interleaved within a single execution context</strong>.</li>
<li>Consider we have a request, and it went through all events, and at some point block on send data back to the client. In the meantime, two requests come in. The fist one is blocking on disk I/O, and second one is waiting on receiving data from client. At this point, all requests are waiting. Later on, each of them will be processed.</li>
<li>Even we only have one thread, we still handling the requests simultaneously.</li>
</ul>
</li>
<li>
<p>Why does this work?</p>
<ul>
<li>On 1 CPU, threads hide latency.
<ul>
<li>it make sense to do context switch if (t_idle &gt; 2 * t_ctx_switch)</li>
<li>but if (t_idle == 0) context switch just waste cycles.</li>
</ul>
</li>
<li>In the event driven model, a request will be processed exactly until a wait is necessary, at which point the execution context will switch to servicing another request.</li>
<li>In a multiple CPUs situation, we can still benefit from the model. Each CPU could host a single event-driven process, and multiple requests could be worked on concurrently within that process.</li>
<li>Gotcha: It is important to have mechanisms that will steer the right set of events to the right CPU.</li>
</ul>
</li>
<li>
<p>How does this work?</p>
<ul>
<li>First of all, both sockets and files are represented by <strong>file descriptors</strong>. An event in the context of the web server is an input on any of the file descriptors associated with it.</li>
<li>So how to know which file descriptors have input?
<ul>
<li>system call <code>select()</code>: scan a range of file descriptors, and return the first one that have input. Another alternative is the <code>poll()</code> system call.</li>
<li>both system calls have to scan through a potentially large list of file descriptors, and it’s likely only few have input, which wastes lots of time.</li>
<li>A more recent system call is <code>epoll()</code>, which eliminates some of the problems that select and poll have.</li>
</ul>
</li>
<li>The benefits of the event driven model mainly come from the design as a single address space with a single flow of control. As a result, the overheads are lower. There is a smaller memory footprint, and no need for context switching or synchronization.</li>
</ul>
</li>
</ul>
<h3 id="helper-threads-and-processes"><a class="markdownIt-Anchor" href="#helper-threads-and-processes"></a> Helper Threads And Processes</h3>
<ul>
<li>
<p>In the many-to-one ULT:KLT model, a ULT might blocks the entire process because the KLT is not aware of the threads in ULT. The event-driven model has the same issue.</p>
</li>
<li>
<p>One way to solve this is to use <strong>asynchronous I/O operations</strong>. The asynchronous system call allows the the process/thread continue execution and check the result later by obtaining the relevant info from the stack and either return the result somewhere, or call the caller with callback function.</p>
</li>
<li>
<p>Asynchronous needs a multithreaded kernel, so the caller and asynchronous call can leave on different threads, and not block each other.</p>
</li>
<li>
<p>What if asynchronous I/O calls are not available?</p>
<ul>
<li>Run <strong>helper</strong> functions on other threads/processes.</li>
<li>
<img src="https://i.imgur.com/e5fUTcZ.jpg" style="width: 400px" />
</li>
<li>When the handler needs to initiate an I/O operation that can block, the handler passes the call to the operation to a <strong>helper</strong>, and returns to the event dispatcher. The helper will be the one that handles the blocking I/O operation and interact with the dispatcher as necessary.</li>
<li>Two models are used in this situation:
<ul>
<li>Asymmetric Multi-Process Event-Driven Model or AMPED.</li>
<li>The multithreaded equivalent acronym is AMTED.</li>
</ul>
</li>
<li>The benefits from these models:
<ul>
<li>resolves portability limitation of basic event-driven model</li>
<li>smaller footprint that regular worker thread</li>
</ul>
</li>
<li>Downside are:
<ul>
<li>applicability to certain classes of applications</li>
<li>there are some complexities surrounding events routing on multi-CPU systems.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="flash-event-driven-web-server"><a class="markdownIt-Anchor" href="#flash-event-driven-web-server"></a> Flash: Event-Driven Web Server</h2>
<ul>
<li>Flash is an event-driven webserver(<strong>AMPED</strong>) with <strong>asymmetric helper processes</strong>
<ul>
<li>helpers used for disk reads (mostly)</li>
<li>pipes used for communication from helpers to dispatcher</li>
<li>helper reads file in memory(via mmap)</li>
<li>dispatcher checks (via <strong>mincore</strong>) if pages are in memory to decide to call “local” handler or helper</li>
</ul>
</li>
<li>Additional optimizations from Flash is application-level caching (data and computation)
<ul>
<li>For instance, every request has an associated pathname, and we need to look up the file given the pathname. That lookup will compute some result, which we can cache so we do not have to perform the same computation again.</li>
</ul>
</li>
</ul>
<h2 id="apache-web-server"><a class="markdownIt-Anchor" href="#apache-web-server"></a> Apache Web Server</h2>
<ul>
<li>
<img src="https://i.imgur.com/LkdkVSo.jpg" style="width: 400px" />
</li>
<li>The core component provides core services like accepting requests, issuing responses, and managing concurrency. The various modules are mounted in a pipeline and extend the functionality of the basic server behavior.</li>
<li>The flow of control is similar to event-driven model, but it’s a combination of multiprocess and multithreaded model, which implements a multithreaded boss/workers configuration with a dynamic thread pool.</li>
<li>The number of processes can also be dynamically adjusted.</li>
</ul>
<h2 id="experimental-methodology"><a class="markdownIt-Anchor" href="#experimental-methodology"></a> Experimental Methodology</h2>
<ul>
<li>Setting up performance comparisons
<ul>
<li>Define comparison points: What systems are you comparing?</li>
<li>Define inputs: What workload will be used?</li>
<li>Define matrices: How will you measure performance?</li>
</ul>
</li>
<li>Flash: What systems are you comparing?
<ul>
<li>a multiprocess, single threaded implementation</li>
<li>a multithreaded implementation using the boss/workers pattern</li>
<li>a single process event-driven (SPED) implementation</li>
<li>Zeus (SPED implementation with two processes)</li>
<li>Apache (multiprocess at the time)</li>
</ul>
</li>
<li>Flash: What workload will be used?
<ul>
<li>Goal:
<ul>
<li>realistic request workload -&gt; distribution of web pages accesses over time</li>
<li>controlled, reproducible workload -&gt; trace-based (from real web servers)</li>
</ul>
</li>
<li>Workload used:
<ul>
<li>CS Web Server trace(Rice Univ.)</li>
<li>Owlnet trace(Rice Univ.)</li>
<li>Synthetic workload</li>
</ul>
</li>
</ul>
</li>
<li>Flash: How will you measure performance?
<ul>
<li>Matrices:
<ul>
<li>Bandwidth (bytes/second) -&gt; total number of bytes transferred / total amount of time took to transfer the bytes</li>
<li>Connection Rate (requests/second) -&gt; total client connections / total amount of time passed</li>
</ul>
</li>
<li>Both of these metrics were evaluated as a function of file size(x-axis), because:
<ul>
<li>with larger file size, the connection cost can be amortized =&gt; higher bandwidth</li>
<li>however, with larger file size, causes more work per connection, aka lower connection rate.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="experimental-results"><a class="markdownIt-Anchor" href="#experimental-results"></a> Experimental Results</h2>
<ul>
<li>
<p>Best Case Numbers</p>
<ul>
<li>Synthetic load: N requests for the same file(after first request, the file will be cached, the following requests will be faster)</li>
<li>Bandwidth measurement:
<ul>
<li>bandwidth = N * file size(bytes) / total time</li>
<li>file size: 0 - 200 KB -&gt; vary work per request</li>
</ul>
</li>
<li>Result:
<ul>
<li>
<img src="https://i.imgur.com/vIuuN6v.jpg" style="width: 300px" />
</li>
<li>All of the implementations had similar results, with bandwidth increasing sharply with file size initially before plateauing.</li>
<li>SPED has the best performance.</li>
<li>Flash has slightly lower performance, because it performs the extra check for memory presence.</li>
<li>Zeus has an anomaly, where it drops in performance after a threshold of around 125Kb.</li>
<li>The performance of the multithreaded/multiprocess implementations are lower because of the extra synchronization requirements and the cost of context switching.</li>
<li>Apache has the lowest performance because it has no optimizations.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>CS Trace &amp; Owlnet Trace</p>
<ul>
<li>
<img src="https://i.imgur.com/1i0i5RF.jpg" style="width: 300px" />
</li>
<li>Owlnet Trace
<ul>
<li>Flash and SPED are the best, followed by MT/MP and then Apache.</li>
<li>The reason for this trend is because the owl trace is very small, so most of the requests can be serviced from the cache. However, not everything can be serviced from cache, so sometimes blocking I/O is required. In this case, SPED will block, but Flash will not because it has helpers. This helps explain why Flash’s performance is slightly higher than the SPED implementation.</li>
</ul>
</li>
<li>CS Trace
<ul>
<li>The CS trace is a much larger trace, which means that most requests are not serviced from the cache.Since the SPED implementation does not support asynchronous I/O the performance drops significantly. The multithreaded implementation does better than the multiprocess implementation because it has a smaller memory footprint (more memory available to cache files) and is able to synchronize more quickly/cheaply.</li>
<li>Flash performs the best. It has the smallest memory footprint, which means it has the most memory available for caching files. As a result, fewer requests will require blocking I/O requests, which further speeds everything up. In addition, since everything occurs in the same address space, there is no need for explicit synchronization.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Impact of Optimizations in Flash</p>
<ul>
<li>
<img src="https://i.imgur.com/nAUmcEe.jpg" style="width: 300px" />
</li>
<li>Fully optimized flash having the highest connection rate at a given file size.</li>
</ul>
</li>
<li>
<p>Summary of Performance Results</p>
<ul>
<li>When data is in cache:
<ul>
<li>SPED &gt;&gt; AMPED Flash: because unnecessary test for memory presence</li>
<li>SPED and AMPED Flash &gt;&gt; MT/MP: sync and context switching overhead</li>
</ul>
</li>
<li>With disk-bound workload
<ul>
<li>AMPED Flash &gt;&gt; SPED: because blocks become no async I/O</li>
<li>AMPED Flash &gt;&gt; MT/MP: because more memory efficient and less context switching</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="advice-on-designing-experiments"><a class="markdownIt-Anchor" href="#advice-on-designing-experiments"></a> Advice on Designing Experiments</h2>
<ul>
<li>Understand the purpose of relevant experiments.
<ul>
<li>Take web server experiment as an example. The clients care about response time, the operators when runs the server care about throughput. So there are several possible goals:
<ul>
<li>+response time, +throughput =&gt; great!</li>
<li>+response time =&gt; acceptable</li>
<li>+response time, -throughput =&gt; maybe useful</li>
<li>maintain response time when request rate increase</li>
</ul>
</li>
<li>The goals are to gain some insight into both the metrics and the configuration our experiments.</li>
</ul>
</li>
<li>Picking the right metrics
<ul>
<li>use “standard” metrics with broader audience</li>
<li>the matrices needs to answer why/what/who questions
<ul>
<li>client performance -&gt; response time, timedout requests, etc.</li>
<li>operator costs -&gt; throughput, costs</li>
</ul>
</li>
</ul>
</li>
<li>Picking the right configuration space
<ul>
<li>Think what you can choose:
<ul>
<li>System resources:
<ul>
<li>hardware(CPU, memory) &amp; software(# of threads, queue size, etc)</li>
</ul>
</li>
<li>Workload
<ul>
<li>webserver: request rate, # of concurrent requests, file size, access pattern</li>
</ul>
</li>
</ul>
</li>
<li>Now pick
<ul>
<li>choose a subset of configuration parameters</li>
<li>pick range for each variable factor</li>
<li>pick relevant workload</li>
<li>include best/worst case scenarios</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="advice-on-running-experiments"><a class="markdownIt-Anchor" href="#advice-on-running-experiments"></a> Advice on Running Experiments</h2>
<ul>
<li>Run test cases N times</li>
<li>Compute metrics</li>
<li>Represent results</li>
<li><strong>Draw a conclusion!</strong></li>
</ul>
<h2 id="papers"><a class="markdownIt-Anchor" href="#papers"></a> Papers</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://s3.amazonaws.com/content.udacity-data.com/courses/ud923/references/ud923-pai-paper.pdf">“Flash: An Efficient and Portable Web Server”</a> by Pai</li>
</ul>

</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>


<!-- The loading of KaTeX is deferred to speed up page rendering -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.3/dist/katex.min.js" integrity="sha384-97gW6UIJxnlKemYavrqDHSX3SiygeOwIZhwyOKRfSaf0JWKRVj9hLASHgFTzT+0O" crossorigin="anonymous"></script>

<!-- To automatically render math in text elements, include the auto-render extension: -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.3/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [
                {left: "$$", right: "$$", display: true},
                {left: "$", right: "$", display: false}
            ]
        });
    });
</script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">
  
  <div class="divider"></div>
</div>

  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>

      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>
