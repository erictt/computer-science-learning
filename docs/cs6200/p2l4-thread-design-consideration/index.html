<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          Eric&#39;s CS Notes
        
    </title>

    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">

    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

<meta name="generator" content="Hexo 6.1.0"></head>


<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>ERIC&#39;S CS NOTES</span>
  </a>
</div>

    <div class="book-menu">
  <!--
## Introduction to Probability

* [Unit 1: Probability models and axioms](/introduction-to-probability/unit-1/index.html)
* [Unit 2: Conditioning and independence](/introduction-to-probability/unit-2/index.html)
* [Unit 3: Counting](/introduction-to-probability/unit-3/index.html)
* [Unit 4: Discrete random variables](/introduction-to-probability/unit-4/index.html)
* [Unit 5: Continuous random variables](/introduction-to-probability/unit-5/index.html)
* [Unit 6: Further topics on random variables](/introduction-to-probability/unit-6/index.html)
* [Unit 7: Bayesian inference](/introduction-to-probability/unit-7/index.html)
* [Unit 8: Limit theorems and classical statistics](/introduction-to-probability/unit-8/index.html)
* [Unit 9: Bernoulli and Poisson processes](/introduction-to-probability/unit-9/index.html)
* [Unit 10: Markov chains](/introduction-to-probability/unit-10/index.html)
-->
<!--
## Multivariable Calculus

* [Unit 1: Thinking about multivariable functions](/multivariable-calculus/unit-1/index.html)
* [Unit 2: Derivatives of multivariable functions](/multivariable-calculus/unit-2/index.html)

* [Unit 3: Applications of multivariable derivatives](/multivariable-calculus/unit-3/index.html)
* [Unit 4: Integrating multivariable functions](/multivariable-calculus/unit-4/index.html)
* [Unit 5: Green's, Stokes', and the divergence theorems](/multivariable-calculus/unit-5/index.html)
-->
<h2><span id="cs6250-computer-networks"> CS6250 Computer Networks</span></h2>
<ul>
<li><a href="/cs6250/week-1-internet-architecture/index.html">Week 1 - Internet Architecture</a></li>
<li><a href="/cs6250/week-2-transport-and-application-layers/index.html">Week 2 - Transport and Application Layers</a></li>
<li><a href="/cs6250/week-3-intradomain-routing/index.html">Week 3 - Intradomain Routing</a></li>
<li><a href="/cs6250/week-4-as-relationships-and-interdomain-routing/index.html">Week 4 - AS Relationships and Interdomain Routing</a></li>
<li><a href="/cs6250/week-5-router-design-and-algorithems-part-1/index.html">Week 5 - Router Design and Algorithms Part 1</a></li>
</ul>
<!--
* [Week 6 - Router Design and Algorithms Part 2](/cs6250/week-6-router-design-and-algorithems-part-2/index.html)
-->
<h2><span id="cs6200-graduate-introduction-to-operating-systems"> CS6200 Graduate Introduction to Operating Systems</span></h2>
<ul>
<li><a href="/cs6200/p1-preparation/index.html">P0 - Preparation</a></li>
<li><a href="/cs6200/p1l2-introduction/index.html">P1L2 - Introduction</a></li>
<li><a href="/cs6200/p2l1-processes-and-process-management/index.html">P2L1 - Processes and Process Management</a></li>
<li><a href="/cs6200/p2l2-threads-and-concurrency/index.html">P2L2 - Threads and Concurrency</a></li>
<li><a href="/cs6200/p2l3-pthread/index.html">P2L3 - PThread</a></li>
<li><a href="/cs6200/p2l4-thread-design-consideration/index.html">P2L4 - Thread Design Considerations</a></li>
</ul>
<!--
* [P2L5 - Thread Performance Considerations](/cs6200/p2l5-thread-performance-consideration/index.html)
-->
<h2><span id="algorithms-part-ii"> Algorithms: Part II</span></h2>
<ul>
<li><a href="/algorithms-2/week-1/index.html">Week 1 - Undirected Graph &amp; Directed Graph</a></li>
<li><a href="/algorithms-2/week-2/index.html">Week 2 - Minimum Spanning Trees &amp; Shortest Path</a></li>
<li><a href="/algorithms-2/week-3/index.html">Week 3 - Maximum Flow and Minimum Cut &amp; String Sort</a></li>
<li><a href="/algorithms-2/week-4/index.html">Week 4 - Tries &amp; Substring Search</a></li>
<li><a href="/algorithms-2/week-5/index.html">Week 5 - Regular Expressions</a></li>
<li><a href="/algorithms-2/week-6/index.html">Week 6 - Reductions</a></li>
</ul>
<h2><span id="algorithms-part-i"> Algorithms: Part I</span></h2>
<ul>
<li><a href="/algorithms-1/week-1/index.html">Week 1 - Union-Find &amp; Analysis of Algorithms</a></li>
<li><a href="/algorithms-1/week-2/index.html">Week 2 - Stacks and Queues &amp; Elementary Sorts</a></li>
<li><a href="/algorithms-1/week-3/index.html">Week 3 - Mergesort &amp; Quicksort</a></li>
<li><a href="/algorithms-1/week-4/index.html">Week 4 - Priority Queues &amp; Elementary Symbols</a></li>
<li><a href="/algorithms-1/week-5/index.html">Week 5 - Balanced Search Trees</a></li>
<li><a href="/algorithms-1/week-6/index.html">Week 6 - Hash Tables</a></li>
</ul>
<h2><span id="introduction-to-software-design-and-architecture"> Introduction to Software Design and Architecture</span></h2>
<ul>
<li><a href="/introduction-to-software-design-and-architecture/design-pattern/index.html">Design Pattern</a></li>
</ul>
<h2><span id="calculus-two-sequences-and-series"> Calculus Two: Sequences and Series</span></h2>
<ul>
<li><a href="/calculus-two/week-1/index.html">Week 1 - Sequences</a></li>
<li><a href="/calculus-two/week-2/index.html">Week 2 - Series</a></li>
<li><a href="/calculus-two/week-3/index.html">Week 3 - Convergence Tests</a></li>
<li><a href="/calculus-two/week-4/index.html">Week 4 - Alternating Series</a></li>
<li><a href="/calculus-two/week-5/index.html">Week 5 - Power Series</a></li>
<li><a href="/calculus-two/week-6/index.html">Week 6 - Taylor Series</a></li>
</ul>
<h2><span id="laff-linear-algebra"> LAFF Linear Algebra</span></h2>
<ul>
<li><a href="/laff-linear-algebra/week-1/index.html">Week 1 - Vectors in Linear Algebra</a></li>
<li><a href="/laff-linear-algebra/week-2/index.html">Week 2 - Linear Transformations and Matrices</a></li>
<li><a href="/laff-linear-algebra/week-3/index.html">Week 3 - Matrix-Vector Operations</a></li>
<li><a href="/laff-linear-algebra/week-4/index.html">Week 4 - Matrix-Vector to Matrix-Matrix Multiplication</a></li>
<li><a href="/laff-linear-algebra/week-5/index.html">Week 5 - Matrix- Matrix Multiplication</a></li>
<li><a href="/laff-linear-algebra/week-6/index.html">Week 6 - Gaussian Elimination</a></li>
<li><a href="/laff-linear-algebra/week-7/index.html">Week 7 - More Gaussian Elimination and Matrix Inversion</a></li>
<li><a href="/laff-linear-algebra/week-8/index.html">Week 8 - More on Matrix Inversion</a></li>
<li><a href="/laff-linear-algebra/week-9/index.html">Week 9 - Vector Spaces</a></li>
<li><a href="/laff-linear-algebra/week-10/index.html">Week 10 - Vector Spaces, Orthogonality, and Linear Least-Squares</a></li>
<li><a href="/laff-linear-algebra/week-11/index.html">Week 11 - Orthogonal Projection, Low Rank Approximation, and Orthogonal Bases</a></li>
<li><a href="/laff-linear-algebra/week-12/index.html">Week 12 - Eigenvalues and Eigenvectors</a></li>
</ul>
<h2><span id="stanford-machine-learning"> Stanford Machine Learning</span></h2>
<ul>
<li><a href="/stanford-machine-learning/week-1/index.html">Week 1 - Introduction</a></li>
<li><a href="/stanford-machine-learning/week-2/index.html">Week 2 - Linear Regression with Multiple Variables</a></li>
<li><a href="/stanford-machine-learning/week-3/index.html">Week 3 - Logistic Regression &amp; Regularization</a></li>
<li><a href="/stanford-machine-learning/week-4/index.html">Week 4 - Neural Networks: Representation</a></li>
<li><a href="/stanford-machine-learning/week-5/index.html">Week 5 - Neural Networks: Learning</a></li>
<li><a href="/stanford-machine-learning/week-6a/index.html">Week 6a - Advice for Applying Machine Learning</a></li>
<li><a href="/stanford-machine-learning/week-6b/index.html">Week 6b - Machine Learning System Design</a></li>
<li><a href="/stanford-machine-learning/week-7/index.html">Week 7 - Support Vector Machines</a></li>
<li><a href="/stanford-machine-learning/week-8/index.html">Week 8 - Unsupervised Learning &amp; Dimensionality Reduction</a></li>
<li><a href="/stanford-machine-learning/week-9a/index.html">Week 9a - Anomaly Detection</a></li>
<li><a href="/stanford-machine-learning/week-9b/index.html">Week 9b - Recommender Systems</a></li>
<li><a href="/stanford-machine-learning/week-10/index.html">Week 10 - Large Scale Machine Learning</a></li>
<li><a href="/stanford-machine-learning/week-11/index.html">Week 11 - Application Example: Photo OCR</a></li>
</ul>
<h2><span id="calculus-one"> Calculus One</span></h2>
<ul>
<li><a href="/calculus-one/week-2-3/index.html">Week 2-3 - Functions &amp; Limits</a></li>
<li><a href="/calculus-one/week-4/index.html">Week 4 - The Beginning of Derivatives</a></li>
<li><a href="/calculus-one/week-5/index.html">Week 5 - Techniques of Differentiation</a></li>
<li><a href="/calculus-one/week-6/index.html">Week 6 - Chain Rule</a></li>
<li><a href="/calculus-one/week-7/index.html">Week 7 - Derivatives of Trigonometric Functions</a></li>
<li><a href="/calculus-one/week-8/index.html">Week 8 - Derivatives in the Real World</a></li>
<li><a href="/calculus-one/week-9/index.html">Week 9 - Optimization</a></li>
<li><a href="/calculus-one/week-10/index.html">Week 10 - Linear Approximation</a></li>
<li><a href="/calculus-one/week-11-12/index.html">Week 11-12 - Antidifferentiation &amp; Integration</a></li>
<li><a href="/calculus-one/week-13/index.html">Week 13 - Fundamental Theorem of Calculus</a></li>
<li><a href="/calculus-one/week-14/index.html">Week 14 - Substitution Rule</a></li>
<li><a href="/calculus-one/week-15/index.html">Week 15 - Techniques of Integration</a></li>
<li><a href="/calculus-one/week-16/index.html">Week 16 - Applications of Integration</a></li>
</ul>
<h2><span id="computational-thinking"> Computational Thinking</span></h2>
<ul>
<li><a href="/computational-thinking/lecture-1/index.html">Lecture 1 - Optimization and Knapsack Problem</a></li>
<li><a href="/computational-thinking/lecture-2/index.html">Lecture 2 - Decision Trees and Dynamic Programming</a>
<ul>
<li><a href="/computational-thinking/lecture-2-powerset/index.html">Exercise: Power Set Function</a></li>
</ul>
</li>
<li><a href="/computational-thinking/lecture-3/index.html">Lecture 3 - Graphs</a></li>
<li><a href="/computational-thinking/lecture-4-5/index.html">Lecture 4-5 - Plotting</a></li>
<li><a href="/computational-thinking/lecture-6-7/index.html">Lecture 6-7 - Stochastic Programs &amp; Inferential Statistics</a></li>
<li><a href="/computational-thinking/lecture-8/index.html">Lecture 8 - Monte Carlo Simulation</a></li>
<li><a href="/computational-thinking/lecture-9/index.html">Lecture 9 - Sampling and Standard Error</a></li>
<li><a href="/computational-thinking/lecture-10-11/index.html">Lecture 10-11 - Experimental Data</a></li>
<li><a href="/computational-thinking/lecture-12/index.html">Lecture 12 - Machine Learning</a></li>
<li><a href="/computational-thinking/lecture-13/index.html">Lecture 13 - Statistical Abuses</a></li>
</ul>
<h2><span id="effective-thinking-through-mathematics"> Effective Thinking Through Mathematics</span></h2>
<ul>
<li><a href="/effective-thinking-through-mathematics/note/index.html">Note</a></li>
<li><a href="/effective-thinking-through-mathematics/week-4-telling-the-story-of-infinity/index.html">Week 4 (/Telling the Story of Infinity)</a></li>
<li><a href="/effective-thinking-through-mathematics/week-5-telling-the-story-of-the-euler-circuit-theorem/index.html">Week 5 (/Telling the Story of Euler Circuit Theorem)</a></li>
</ul>
<h2><span id="cs50-introduction-to-computer-science"> CS50 Introduction to Computer Science</span></h2>
<ul>
<li><a href="/cs50/week-1/index.html">Week 1 - C</a></li>
<li><a href="/cs50/week-2/index.html">Week 2 - Arrays</a></li>
<li><a href="/cs50/week-3/index.html">Week 3 - Algorithms</a></li>
<li><a href="/cs50/week-4/index.html">Week 4 - Memory</a></li>
<li><a href="/cs50/week-5/index.html">Week 5 - Data Structures</a></li>
<li><a href="/cs50/week-6/index.html">Week 6 - HTTP</a></li>
<li><a href="/cs50/week-7-10/index.html">Week 7-10 - Machine Learning/Python/SQL/Javascript</a></li>
</ul>
<h2><span id="others"> Others</span></h2>
<ul>
<li><a href="/symbols/index.html">Symbols of Mathematics</a></li>
<li><a href="/glossary/index.html">Glossary</a></li>
</ul>

</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="sidebar-toggle" onclick="sidebar_toggle()" onmouseover="add_inner()" onmouseleave="remove_inner()">
  <div class="sidebar-toggle-inner"></div>
</div>

<script>
function add_inner() {
  let inner = document.querySelector('.sidebar-toggle-inner')
  inner.classList.add('show')  
}

function remove_inner() {
  let inner = document.querySelector('.sidebar-toggle-inner')
  inner.classList.remove('show')
}

function sidebar_toggle() {
    let sidebar_toggle = document.querySelector('.sidebar-toggle')
    let sidebar = document.querySelector('.book-sidebar')
    let content = document.querySelector('.off-canvas-content')
    if (sidebar_toggle.classList.contains('extend')) { // show
        sidebar_toggle.classList.remove('extend')
        sidebar.classList.remove('hide')
        content.classList.remove('extend')
    }
    else { // hide
        sidebar_toggle.classList.add('extend')
        sidebar.classList.add('hide')
        content.classList.add('extend')
    }
}
</script>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <h1><span id="p2l4-thread-design-considerations"> P2L4: Thread Design Considerations</span></h1>
<!-- toc -->
<ul>
<li><a href="#kernel-vs-user-level-threads">Kernel Vs. User Level Threads</a></li>
<li><a href="#thread-related-data-structures">Thread Related Data Structures</a>
<ul>
<li><a href="#single-cpu">Single CPU</a></li>
<li><a href="#at-scale">At Scale</a></li>
<li><a href="#hard-and-light-process-state">Hard and Light Process State</a></li>
<li><a href="#rationale-for-data-structures">Rationale For Data Structures</a></li>
</ul>
</li>
<li><a href="#data-structures-in-solaris-20os">Data Structures in Solaris 2.0(OS)</a>
<ul>
<li><a href="#user-level-structures">User Level Structures</a></li>
<li><a href="#kernel-level-structures">Kernel Level Structures</a></li>
</ul>
</li>
<li><a href="#thread-management-interaction">Thread Management Interaction</a>
<ul>
<li><a href="#visibility-in-bewteen">Visibility in Bewteen</a></li>
</ul>
</li>
<li><a href="#interrupts-and-signals">Interrupts and Signals</a>
<ul>
<li><a href="#interrupts">Interrupts</a></li>
<li><a href="#signals">Signals</a></li>
<li><a href="#signalinterrupt-similarities">Signal/Interrupt Similarities</a></li>
<li><a href="#interrupt-handling">Interrupt Handling</a></li>
<li><a href="#signal-handling">Signal Handling</a></li>
<li><a href="#why-disable-interrupts-or-signals">Why Disable Interrupts or Signals?</a></li>
<li><a href="#more-on-signal-masks">More on Signal Masks</a></li>
<li><a href="#interrupts-on-multicore-systems">Interrupts on Multicore Systems</a></li>
<li><a href="#types-of-signals">Types of Signals</a></li>
<li><a href="#interrupts-as-threads">Interrupts as Threads</a></li>
<li><a href="#interrupts-top-vs-bottom-half">Interrupts: Top Vs. Bottom Half</a></li>
<li><a href="#performance-of-threads-as-interrupts">Performance of Threads as Interrupts</a></li>
<li><a href="#threads-and-signal-handling">Threads and Signal Handling</a></li>
<li><a href="#tasks-in-linux">Tasks in Linux</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<hr>
<h2><span id="kernel-vs-user-level-threads"> Kernel Vs. User Level Threads</span></h2>
<ul>
<li><a href="/cs6200/p2l2-threads-and-concurrency/index.html#kernel-level-threads-vs-user-level-threads">A review of the concept</a>
<ul>
<li><img src="media/16646342125616.jpg" alt></li>
</ul>
</li>
</ul>
<h2><span id="thread-related-data-structures"> Thread Related Data Structures</span></h2>
<h3><span id="single-cpu"> Single CPU</span></h3>
<ul>
<li>A process is described by its process control block, which contains:
<ul>
<li>virtual address mapping</li>
<li>stack</li>
<li>registers</li>
</ul>
</li>
<li>If the process links in a <strong>user-level threading</strong>(ULT) library, the library will maintain a user-level thread data structure, which contains:
<ul>
<li>user-level thread id</li>
<li>user-level registers</li>
<li>thread stack</li>
</ul>
</li>
<li>If we want the multiple kernel-level threads associated with the threads in the process, the PCB needs to be duplicated for each kernel-level thread. To avoid the duplication, we can split the PCB into smaller data structures:
<ul>
<li>The PCB only keep the virtual address mapping,</li>
<li>The <strong>kernel-level thread</strong>(KLT) keeps the stack and register</li>
<li><img src="media/16646458881018.jpg" alt></li>
</ul>
</li>
</ul>
<h3><span id="at-scale"> At Scale</span></h3>
<ul>
<li>In a multiple processes situation, there will be multiple ULT, PCB and KLT. To cope with this, the system need to maintain the relationships: ULT &lt;-&gt; PCB, PCB &lt;-&gt; KLT. And the system has multiple CPU, we also need to maintain the relationship: CPU &lt;-&gt; KLT.</li>
<li><img src="media/16646480566517.jpg" alt></li>
<li>For each process, we need to track the kernel level threads that execute on behalf the process, and the for each kernel level thread, we need to track of the processes on whose behalf we execute.</li>
<li>When kernel itself is multithreaded, we can have multiple kernel-level threads supporting a single user-level process. When kernel needs to schedule/context switch among kernel-level threads that belong to diff processes, it can quickly determine the KLT point to diff PCB.</li>
</ul>
<h3><span id="hard-and-light-process-state"> Hard and Light Process State</span></h3>
<ul>
<li>When the operating system context switches between two kernel level threads that belong to the process, there is information relevant to both threads in the process control block, and also information that is only relevant to each thread.</li>
<li>Information relevant to all threads includes the virtual address mapping, while information relevant to each thread specifically can include things like signals or system call arguments. When context switching among the two kernel level threads, we want to preserve some portion of the PCB and swap out the rest.</li>
<li>We can split up the information in the PCB into <strong>hard process state</strong> which is <u>relevant for all user level threads</u> in a given process and l<strong>ight process state</strong> that is <u>only relevant for a subset of user level threads</u> associated with a particular kernel level thread.</li>
<li><img src="media/16646487555398.jpg" alt></li>
</ul>
<h3><span id="rationale-for-data-structures"> Rationale For Data Structures</span></h3>
<ul>
<li>Single control block:
<ul>
<li>large continuous data structure</li>
<li>private for each entity (even though some information can be shared)</li>
<li>saved and restored in entirety on each context switch</li>
<li>updates may be challenging</li>
</ul>
</li>
<li>Multiple data structures:
<ul>
<li>smaller data structures</li>
<li>easier to share</li>
<li>save and restore only what needs to change on context switch</li>
<li>user-level library only needs to update a portion of the state for customized behavior</li>
</ul>
</li>
</ul>
<h2><span id="data-structures-in-solaris-20os"> Data Structures in Solaris 2.0(OS)</span></h2>
<ul>
<li>The OS is intended for multiple CPU and multi-threads. Each kernel-level thread has a lightweight process data structure associated with it, called <strong>lightweight process(LWP)</strong>, which represents the virtual CPUs onto which the user-level threads are scheduled. And the kernel-level scheduler is responsible for scheduling the kernel-level threads onto physical CPU.</li>
</ul>
<h3><span id="user-level-structures"> User Level Structures</span></h3>
<ul>
<li>From paper: <a target="_blank" rel="noopener" href="https://s3.amazonaws.com/content.udacity-data.com/courses/ud923/references/ud923-stein-shah-paper.pdf">“Implementing Lightweight Threads”</a> by Stein and Shah
<ul>
<li>not POSIX threads, but similar</li>
</ul>
</li>
<li>When a thread is created, the library returns a thread id(tid). This id is <strong>not a direct pointer to</strong> the thread data structure but is rather an index into an array of thread pointers. the reason for that is, if there is a problem with the thread, the value at the index can change to -1 instead of the pointer just pointing to some corrupt memory.</li>
<li>The thread data structure:
<ul>
<li><img src="media/16646504360386.jpg" alt></li>
</ul>
</li>
<li>To avoid one thread overrun its boundary and overwrite the data for the next thread, we create a red zone for separating the threads. <strong>Red zone</strong> is a portion of the address space that is not allocated. If a thread tries to write to a red zone, the operating system causes a fault.</li>
</ul>
<h3><span id="kernel-level-structures"> Kernel Level Structures</span></h3>
<ul>
<li>
<p><img src="media/16646512877709.jpg" alt></p>
</li>
<li>
<p>Data structures in details</p>
<ul>
<li>Process:
<ul>
<li>list of kernel level threads</li>
<li>virtual address space</li>
<li>user credentials</li>
<li>signal handlers</li>
</ul>
</li>
<li><strong>light-weight process (LWP)</strong>:
<ul>
<li>user level registers</li>
<li>system call arguments</li>
<li>resource usage info</li>
<li>signal masks</li>
</ul>
</li>
<li>Kernel-level thread(KLT):
<ul>
<li>kernel-level registers</li>
<li>stack pointer</li>
<li>scheduling info</li>
<li>pointers to associated LWPs, and CPU structures</li>
</ul>
</li>
<li>CPU:
<ul>
<li>current thread</li>
<li>list of kernel level threads</li>
<li>dispatching &amp; interrupt handling information</li>
</ul>
</li>
</ul>
</li>
<li>
<p>LWP contains data that is relevant for some subset of the user threads in a given process, which is similar to the data contained in the ULT, but the LWP is visible to the kernel. When the kernel needs to make scheduling decisions, they can look at the LWP to help make decisions.</p>
</li>
<li>
<p>The KLT has information about an execution context that is always needed. There are operating system services (for example, scheduler) that need to access information about a thread even when the thread is not active. As a result, <strong>the information in the kernel level thread is not swappable</strong>. The LWP data does not have to be present when a process is not running, so its data can be swapped out.</p>
</li>
</ul>
<h2><span id="thread-management-interaction"> Thread Management Interaction</span></h2>
<ul>
<li>Why kernel-level threads and user-level threads need to interact with each other?
<ul>
<li>Consider a process with four user threads, and a kernel with two threads. At a given time, the process require the level of concurrency to two. It always happens that two of its threads are blocking on, say, IO and the other two threads are executing.</li>
<li>Consider the scenario where the two user level threads that are scheduled on the kernel level threads happen to be the two that block. The kernel level threads block as well. This means that the whole process is blocked, even though there are user level threads that can make progress. The user threads have no way to know that the kernel threads are about to block, and has no way to decide before this event occurs.</li>
<li>It would be helpful if the kernel can <strong>signal</strong> the user-level library before blocking, and the user-level library could potentially request more kernel-level threads, or allocate one kernel thread to  other threads that can be executed immediately.</li>
</ul>
</li>
</ul>
<h3><span id="visibility-in-bewteen"> Visibility in Bewteen</span></h3>
<ul>
<li>
<p>The kernel sees:</p>
<ul>
<li>Kernel-level threads</li>
<li>CPUs</li>
<li>Kernel-level scheduler</li>
</ul>
</li>
<li>
<p>The user-level library sees:</p>
<ul>
<li>User-level threads</li>
<li>Available kernel-level threads</li>
</ul>
</li>
<li>
<p>A case of invisibility:</p>
<ul>
<li>In a many-to-many case, if a user level thread acquires a lock while running on top of a kernel level thread and that kernel level thread gets preempted, the user level library scheduler will cycle through the remaining user level threads and try to schedule them. If they need the lock, none will be able to execute and time will be wasted until the thread holding the lock is scheduled again.</li>
<li></li>
</ul>
</li>
</ul>
<p>Issue On Multiple CPUs</p>
<p>Synchronization Related Issues</p>
<h2><span id="interrupts-and-signals"> Interrupts and Signals</span></h2>
<h3><span id="interrupts"> Interrupts</span></h3>
<h3><span id="signals"> Signals</span></h3>
<h3><span id="signalinterrupt-similarities"> Signal/Interrupt Similarities</span></h3>
<h3><span id="interrupt-handling"> Interrupt Handling</span></h3>
<h3><span id="signal-handling"> Signal Handling</span></h3>
<h3><span id="why-disable-interrupts-or-signals"> Why Disable Interrupts or Signals?</span></h3>
<h3><span id="more-on-signal-masks"> More on Signal Masks</span></h3>
<h3><span id="interrupts-on-multicore-systems"> Interrupts on Multicore Systems</span></h3>
<h3><span id="types-of-signals"> Types of Signals</span></h3>
<h3><span id="interrupts-as-threads"> Interrupts as Threads</span></h3>
<h3><span id="interrupts-top-vs-bottom-half"> Interrupts: Top Vs. Bottom Half</span></h3>
<h3><span id="performance-of-threads-as-interrupts"> Performance of Threads as Interrupts</span></h3>
<h3><span id="threads-and-signal-handling"> Threads and Signal Handling</span></h3>
<h3><span id="tasks-in-linux"> Tasks in Linux</span></h3>

</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>

<!-- To automatically render math in text elements, include the auto-render extension: -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [
                {left: "$$", right: "$$", display: true},
                {left: "$", right: "$", display: false}
            ]
        });
    });
</script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">
  
  <div class="divider"></div>
</div>

  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>

      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>
